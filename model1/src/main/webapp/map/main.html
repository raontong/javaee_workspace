<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
	.container{
		width: 1100px;
		height: 500px;
		margin: auto;
		
		
	}
	.aside{
		width: 100px;
		height: 100%;
		float: left;
		background-color: antiquewhite;
	}
	.content{
		width: 1000px;
		height: 100%;
		float: left;
		background-color: bisque;
	}
	
</style>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
	let map; // 모든 함수에서 접근하게 될 구급맵 객체
	// 아래쪽 급맵의 스크립트의 의해 구글맵이 로드가 되면 이 함수를 호출하게 됨
	function init(){
		let mapProp= {
			center:new google.maps.LatLng(51.508742,-0.120850),
  			zoom:18
		};
		
		// 카메라는 mapProp가 결정
		map = new google.maps.Map(document.querySelector(".content"),mapProp);
	}	
	
	//  서버로 부터 받은 데이터를 파싱 결과인 객체를 이용하여, 화면에 표현
	function render(data){
		console.log("랜더링 전 넘겨 받은 객체는", this.data);
		// 구구맵에 마커 표시하기(벤더사가 제작했으므로, 각 벤더사에서 제공하는 API 이용해야 함, google, naver, kakao..)
		let lati = data.response.body.items.item[0].lat; // 위도
		let lng = data.response.body.items.item[0].lot; // 경도
		// reference에서 확인 -->	https://www.w3schools.com/graphics/google_maps_reference.asp
		// 먼저 카메라의 위치부터 수정(맵의 중아부를 교체)
		let pos=new google.maps.LatLng(lati, lng);
		map.setCenter(pos); // 카메라 이동
		// https://www.w3schools.com/graphics/google_maps_overlays.asp 가져옴
		// mycenter에 https://www.w3schools.com/graphics/google_maps_basic.asp 가져옴
		let marker = new google.maps.Marker({
			position: pos,
			// 마커 애니메이션
			//https://www.w3schools.com/graphics/google_maps_overlays.asp
			animation:google.maps.Animation.BOUNCE
		});

		// 생성된 마커를 원하는 맵 객체에 적용하기
		marker.setMap(map);
		// 팝업 윈도우 띄우기
		let info=data.response.body.items.item[0].frtrlNm; // 산의 이름
		let infowindow = new google.maps.InfoWindow({
			  content:info
		});
		infowindow.open(map,marker); // 어떤 맵 객체에, 어떤 마커위로 띄울지 결정
	}
	
	// 맵 등 애플리케이션은 새로고침이 발생하면 불편함이 생기므로, 데이터를 비동기(백그라운드)로 가져오자
	function getList(){
		let xhttp=new XMLHttpRequest();
		// 요청에 대한 서버측의 응답이 돌아오면, 브라우저가 자바스크립트에게 도착했음을 알린다. 
		// 이때 자바스크립트는 아래의 익명함수 호출
		xhttp.onload=function(){
			console.log("서버로부터 받은 문자열은", this.responseText);
			// 서버에 가져온 데이터는 직접 사용이 불편한 물자열이므로, 객체로 전환
			let obj=JSON.parse(this.responseText); 
			render(obj);
		};
		// servlet,jsp 둘다가능은 하지만 디자인이 포함되지 않으므로, 원칙상 서블릿으로 해야한다. 지금바쁨
		xhttp.open("GET","/map/list.jsp"); 
		xhttp.send(); // 비동기 요청발생!! 너출발해~
	}

	$(()=>{
		$("button").click(()=>{
			getList();
		});
	});
	
</script>
</head>
<body>
	<div class="container">
		<div class="aside">
			<button type="button">load</button>
		</div>
		<div class="content"></div>
	</div>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMbLPEMxSW9qzT1-TlcpCKqI_PaHBWkww&callback=init"></script>
</body>
</html>